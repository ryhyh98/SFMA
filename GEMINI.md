
# 스마트공장 수준 진단 프로그램 개발 요약

## 1. 프로젝트 목표

사용자의 요구에 따라 스마트공장 수준을 진단하는 웹 애플리케이션을 개발. 주요 기능은 웹 기반 설문, 진단 결과 분석, 결과 리포트(이미지, 표, 차트 포함) 표시, PDF/Excel 파일 저장 등임.

## 2. 개발 과정

### 2.1. 초기 분석 및 계획 수립

*   사용자가 제공한 `기업제조혁신역량 수준.xlsx`, `스마트공장수준진단결과.jpg`, `스마트팩토리수준진단_input.csv`, `sfactory_기준.txt` 등의 파일을 분석하여 요구사항을 파악함.
*   요구사항을 바탕으로 `prd.md` (제품 요구사항 문서)를 작성함.
*   Python Flask 기반의 백엔드와 HTML/CSS/JavaScript 기반의 프론트엔드 개발 계획을 수립함.

### 2.2. 핵심 기능 개발

*   **백엔드 (`app.py`):**
    *   Flask 웹 서버를 구축하고, `스마트팩토리수준진단_input.csv` 파일에서 질문 데이터를 읽어오는 API (`/api/questions`)를 구현함.
    *   진단 결과를 제출받아 점수를 계산하고, 결과를 저장하는 API (`/api/submit_diagnosis`)를 구현함.
*   **프론트엔드 (`index.html`):**
    *   Bootstrap과 Chart.js를 사용하여 사용자 인터페이스를 구축함.
    *   백엔드 API와 연동하여 동적으로 설문지를 생성하고, 진단 완료 후 결과(점수, 레벨, 차트 등)를 표시하도록 개발함.

### 2.3. 고급 기능 추가

*   **결과 포맷 변경:** 사용자의 요구에 따라, `스마트공장수준진단결과.jpg` 이미지와 동일한 형태로 결과 화면을 수정함. (표, 막대 차트 등 포함)
*   **파일 저장 기능:**
    *   진단 결과를 **Excel 파일**로 다운로드하는 기능을 구현함 (`/api/download_excel`). `openpyxl` 라이브러리를 사용하여 차트와 스타일을 적용함.
    *   진단 결과를 **PDF 파일**로 다운로드하는 기능을 구현함 (`/api/download_pdf`). `fpdf2`와 `matplotlib` 라이브러리를 사용하였고, 한글 폰트(`NanumGothic.ttf`)를 내장하여 한글 깨짐 문제를 해결함.

### 2.4. 문제 해결 및 디버깅

개발 과정에서 '진단 결과 제출 실패' 오류가 여러 차례 발생하여, 다음과 같은 다각적인 디버깅을 통해 문제를 해결함:

*   **오류 수정:**
    *   Excel 저장 시 잘못된 인자 사용 오류 수정.
    *   점수 합산 변수(`total_score`) 누락 오류 수정.
    *   코드 수정 과정에서 누락된 `get_questions` API 복원.
    *   결과 파일 저장 로직 누락 문제 해결.
    *   함수 호출 순서 오류 (`get_final_level_name` 함수를 호출 전에 정의하도록 수정) 해결.
*   **원인 분석:** 정확한 원인 파악을 위해 백엔드 코드에 상세한 **로그(Logging)**를 추가하여 단계별 실행 과정을 추적하고, 이를 통해 최종적으로 문제를 해결함.

## 3. 최종 결과

모든 기능이 정상적으로 동작하고, 사용자가 최종적으로 문제 해결을 확인하며 프로젝트를 성공적으로 완료함.
